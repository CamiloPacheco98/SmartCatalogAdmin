<div class="order-details-container" *ngIf="order">
  <!-- Header Section -->
  <div class="order-header">
    <div class="order-title">
      <button class="btn btn-outline btn-sm back-button" (click)="goBackToOrders()">
        ‚Üê {{ 'app.orderDetails.backToOrders' | translate }}
      </button>
      <h1>{{ 'app.orderDetails.orderDetailsTitle' | translate }}</h1>
      <div class="order-id">#{{ order.id }}</div>
    </div>
    <div class="order-status">
      <span class="status-badge" [ngClass]="'status-' + order.status">
        {{ 'app.orders.status.' + order.status | translate }}
      </span>
    </div>
  </div>

  <!-- Order Information Cards -->
  <div class="order-info-grid">
    <!-- Order Summary Card -->
    <div class="info-card">
      <div class="card-header">
        <h3>{{ 'app.orderDetails.orderSummaryTitle' | translate }}</h3>
        <button class="expand-button" (click)="toggleOrderSummaryExpansion()" [class.expanded]="isOrderSummaryExpanded">
          <span class="expand-icon">{{ isOrderSummaryExpanded ? '‚ñº' : '‚ñ∂' }}</span>
          <span class="expand-text">{{ isOrderSummaryExpanded ? ('app.orderDetails.hideProducts' | translate) :
            'app.orderDetails.viewProducts' |
            translate }}</span>
        </button>
      </div>
      <div class="card-content">
        <div class="info-row">
          <span class="label">{{ 'app.orderDetails.createdLabel' | translate }}:</span>
          <span class="value">{{ order.createdAt | date:"d 'de' MMMM 'de' y, HH:mm" }}</span>
        </div>
        <div class="info-row">
          <span class="label">{{ 'app.orderDetails.totalProductsLabel' | translate }}:</span>
          <span class="value">{{ totalProducts }} {{ 'app.orderDetails.products' | translate }}</span>
        </div>
        <div class="info-row">
          <span class="label">{{ 'app.orderDetails.subtotalLabel' | translate }}:</span>
          <span class="value">{{ subtotal | currency:'COP' : 'symbol' : '1.0-0' }}</span>
        </div>
        <div class="info-row total-row">
          <span class="label">{{ 'app.orderDetails.totalLabel' | translate }}:</span>
          <span class="value total-amount">{{ order.total | currency:'COP' : 'symbol' : '1.0-0' }}</span>
        </div>

        <!-- Expandable Products Detail -->
        <div class="expandable-content" [class.expanded]="isOrderSummaryExpanded">
          <div class="products-breakdown">
            <h4>{{ 'app.orderDetails.productsBreakdownTitle' | translate }}</h4>
            <div class="products-list" *ngIf="order.products && order.products.length > 0">
              <div class="product-breakdown-item" *ngFor="let product of order.products; trackBy: trackByProductId">
                <div class="product-details">
                  <span class="product-name">{{ product.name }}</span>
                  <span class="product-page"> {{ 'app.orderDetails.page' | translate }} {{ product.pageIndex }}</span>
                </div>
                <div class="product-quantity-price">
                  <span class="quantity">{{ 'app.orderDetails.quantity' | translate }}: {{ product.quantity }}</span>
                  <span class="unit-price">{{ product.price | currency:'COP' : 'symbol' : '1.0-0' }} {{
                    'app.orderDetails.unitPrice' | translate }}</span>
                  <span class="total-price">{{ product.price * product.quantityNumber | currency:'COP' : 'symbol' :
                    '1.0-0' }}</span>
                </div>
              </div>
            </div>
            <div class="breakdown-total">
              <div class="breakdown-row">
                <span class="label">{{ 'app.orderDetails.subtotalLabel' | translate }}:</span>
                <span class="value">{{ subtotal | currency:'COP' : 'symbol' : '1.0-0' }}</span>
              </div>
              <div class="breakdown-row total-row">
                <span class="label">{{ 'app.orderDetails.totalLabel' | translate }}:</span>
                <span class="value total-amount">{{ order.total | currency:'COP' : 'symbol' : '1.0-0' }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Customer Information Card -->
    <div class="info-card">
      <div class="card-header">
        <h3>{{ 'app.orderDetails.customerInformationTitle' | translate }}</h3>
      </div>
      <div class="card-content">
        <div class="customer-avatar">
          <img [src]="order.user.imagePath || '/default-avatar.svg'" [alt]="order.user.name" class="avatar-image">
        </div>
        <div class="customer-info">
          <div class="info-row">
            <span class="label">{{ 'app.orderDetails.nameLabel' | translate }}:</span>
            <span class="value">{{ order.user.name }} {{ order.user.lastName }}</span>
          </div>
          <div class="info-row">
            <span class="label">{{ 'app.orderDetails.emailLabel' | translate }}:</span>
            <span class="value">{{ order.user.email }}</span>
          </div>
          <div class="info-row">
            <span class="label">{{ 'app.orderDetails.documentNumberLabel' | translate }}:</span>
            <span class="value">{{ order.user.documentNumber }}</span>
          </div>
          <div class="info-row">
            <span class="label">{{ 'app.orderDetails.verifiedLabel' | translate }}:</span>
            <span class="value" [ngClass]="order.user.verified ? 'verified' : 'not-verified'">
              {{ order.user.verified ? ('app.orderDetails.yes' | translate) : ('app.orderDetails.no' | translate) }}
            </span>
          </div>
          <div class="info-row">
            <span class="label">{{ 'app.orderDetails.userTypeLabel' | translate }}:</span>
            <span class="value user-type">{{ order.user.type === 'admin' ? 'app.orderDetails.admin' :
              'app.orderDetails.user' |
              translate }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Products Section -->
  <div class="products-section">
    <div class="section-header">
      <h2>{{ 'app.orderDetails.productsInOrderTitle' | translate }}</h2>
      <span class="product-count">{{ totalProducts }} {{ 'app.orderDetails.products' | translate }}</span>
    </div>

    <div class="products-grid" *ngIf="order.products && order.products.length > 0">
      <div class="product-card" *ngFor="let product of order.products; trackBy: trackByProductId">
        <div class="product-info">
          <h4 class="product-name">{{ product.name }}</h4>
          <p class="product-description">{{ product.desc }}</p>
          <div class="product-meta">
            <span class="product-page"> {{ 'app.orderDetails.page' | translate }} {{ product.pageIndex }}</span>
          </div>
        </div>
        <div class="product-price">
          <span class="price-amount">{{ product.price | currency:'COP' : 'symbol' : '1.0-0' }}</span>
        </div>
      </div>
    </div>

    <div class="no-products" *ngIf="!order.products || order.products.length === 0">
      <div class="no-products-icon">üì¶</div>
      <p>{{ 'app.orderDetails.noProductsInOrder' | translate }}</p>
    </div>
  </div>

  <!-- Order Timeline (Optional) -->
  <div class="order-timeline">
    <div class="section-header">
      <h2>{{ 'app.orderDetails.orderHistoryTitle' | translate }}</h2>
    </div>
    <div class="timeline">
      <div class="timeline-item">
        <div class="timeline-marker created"></div>
        <div class="timeline-content">
          <h4>{{ 'app.orderDetails.orderCreatedTitle' | translate }}</h4>
          <p>{{ order.createdAt | date:"d 'de' MMMM 'de' y, HH:mm" }}</p>
        </div>
      </div>
      <div class="timeline-item" [ngClass]="{'active': order.status !== 'pending'}">
        <div class="timeline-marker processing"></div>
        <div class="timeline-content">
          <h4>{{ 'app.orderDetails.processingOrderTitle' | translate }}</h4>
          <p *ngIf="order.status === 'processing'">{{ 'app.orderDetails.processingOrder' | translate }}</p>
          <p *ngIf="order.status !== 'processing'">{{ 'app.orderDetails.pending' | translate }}</p>
        </div>
      </div>
      <div class="timeline-item" [ngClass]="{'active': order.status === 'shipped' || order.status === 'delivered'}">
        <div class="timeline-marker shipped"></div>
        <div class="timeline-content">
          <h4>{{ 'app.orderDetails.shippedOrderTitle' | translate }}</h4>
          <p *ngIf="order.status === 'shipped'">{{ 'app.orderDetails.productOnTheWay' | translate }}</p>
          <p *ngIf="order.status === 'delivered'">{{ 'app.orderDetails.delivered' | translate }}</p>
          <p *ngIf="order.status !== 'shipped' && order.status !== 'delivered'">{{ 'app.orderDetails.pending' |
            translate }}</p>
        </div>
      </div>
      <div class="timeline-item" [ngClass]="{'active': order.status === 'delivered'}">
        <div class="timeline-marker delivered"></div>
        <div class="timeline-content">
          <h4>{{ 'app.orderDetails.deliveredOrderTitle' | translate }}</h4>
          <p *ngIf="order.status === 'delivered'">{{ 'app.orderDetails.orderCompleted' | translate }}</p>
          <p *ngIf="order.status !== 'delivered'">{{ 'app.orderDetails.pending' | translate }}</p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Loading State -->
<div class="loading-container" *ngIf="loading">
  <div class="loading-spinner"></div>
  <p>{{ 'app.orderDetails.loadingOrderDetails' | translate }}</p>
</div>

<!-- Error State -->
<div class="error-container" *ngIf="error && !loading">
  <div class="error-icon">‚ö†Ô∏è</div>
  <h3>{{ 'app.orderDetails.errorLoadingOrderDetails' | translate }}</h3>
  <p>{{ error }}</p>
  <button class="btn btn-primary" (click)="goBackToOrders()">
    {{ 'app.orderDetails.backToOrders' | translate }}
  </button>
</div>